<!--<head>-->
<!--  <script src="https://cdn.tailwindcss.com"></script>-->
<!--</head>-->

<!--<div class="min-h-screen bg-gradient-to-b from-blue-50 to-blue-100 py-10 px-4">-->
<!--  <div class="bg-white shadow-xl rounded-xl p-8 max-w-5xl mx-auto">-->
<!--    &lt;!&ndash; Заголовок профиля &ndash;&gt;-->
<!--    <div class="text-center mb-8">-->
<!--      <h1 class="text-4xl font-extrabold text-blue-800">Профиль родителя</h1>-->
<!--      {% if can_edit %}-->
<!--        <p class="text-gray-600">Просмотр и редактирование личной информации</p>-->
<!--      {% endif %}-->
<!--    </div>-->

<!--    &lt;!&ndash; Блок профиля &ndash;&gt;-->
<!--    <div class="flex flex-col md:flex-row items-center md:items-start gap-8">-->
<!--      &lt;!&ndash; Фото профиля &ndash;&gt;-->
<!--      <div class="flex-shrink-0 relative">-->
<!--        <img-->
<!--          src="{{ user_data.image }}"-->
<!--          alt="Profile Picture"-->
<!--          class="w-44 h-44 rounded-full object-cover border-4 border-blue-600 shadow-lg hover:scale-105 transform transition-all duration-300"-->
<!--          loading="lazy"-->
<!--        />-->
<!--      </div>-->

<!--      &lt;!&ndash; Информация о профиле &ndash;&gt;-->
<!--      <div class="flex-1">-->
<!--        <div class="space-y-6">-->
<!--          <div>-->
<!--            <p class="text-sm text-gray-500">Имя</p>-->
<!--            <h2 class="text-2xl font-semibold text-blue-900">{{ user_data.first_name }} {{ user_data.last_name }}</h2>-->
<!--          </div>-->
<!--          <div>-->
<!--            <p class="text-sm text-gray-500">Электронная почта</p>-->
<!--            <p class="text-lg text-gray-700">{{ user_data.email }}</p>-->
<!--          </div>-->
<!--          <div>-->
<!--            <p class="text-sm text-gray-500">Мобильный номер</p>-->
<!--            <p class="text-lg text-gray-700">{{ user_data.mobile }}</p>-->
<!--          </div>-->
<!--          <div>-->
<!--            <p class="text-sm text-gray-500">Адрес</p>-->
<!--            <p class="text-lg text-gray-700">{{ user_data.address|default:'' }}</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Уведомление о добавлении ребенка &ndash;&gt;-->
<!--    {% if messages %}-->
<!--      <div class="mt-4" id="notification" class="hidden">-->
<!--        {% for message in messages %}-->
<!--          <div class="bg-green-500 text-white p-4 rounded-lg">-->
<!--            {{ message }}-->
<!--          </div>-->
<!--        {% endfor %}-->
<!--      </div>-->
<!--    {% endif %}-->

<!--    &lt;!&ndash; Список детей &ndash;&gt;-->
<!--    <div>-->
<!--      <h3 class="text-2xl font-bold text-blue-800 mb-4">Дети</h3>-->
<!--      <div class="grid gap-6 md:grid-cols-2">-->
<!--        {% for child in children %}-->
<!--          <div class="bg-gray-100 p-6 rounded-lg shadow-md hover:shadow-lg transition">-->
<!--            <h4 class="text-lg font-semibold text-gray-800">{{ child.first_name }} {{ child.last_name }}</h4>-->
<!--            <p class="text-gray-600">Дата рождения: {{ child.birth_date }}</p>-->
<!--          </div>-->
<!--        {% empty %}-->
<!--          <p class="text-gray-500">Нет данных о детях.</p>-->
<!--        {% endfor %}-->
<!--      </div>-->

<!--      &lt;!&ndash; Кнопка для открытия формы добавления ребенка &ndash;&gt;-->
<!--      {% if can_edit %}-->
<!--        <button-->
<!--          type="button"-->
<!--          onclick="toggleChildForm()"-->
<!--          class="mt-4 bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 focus:outline-none transition"-->
<!--          aria-expanded="false"-->
<!--          aria-controls="child-form"-->
<!--        >-->
<!--          {% if form_submitted %}-->
<!--            Дети добавлены-->
<!--          {% else %}-->
<!--            Добавить ребенка-->
<!--          {% endif %}-->
<!--        </button>-->
<!--      {% endif %}-->

<!--      &lt;!&ndash; Форма добавления ребенка (скрыта по умолчанию) &ndash;&gt;-->
<!--      <div id="child-form" class="mt-6 hidden">-->
<!--        <form method="POST" class="space-y-6">-->
<!--          {% csrf_token %}-->
<!--          <div class="grid gap-6 md:grid-cols-2">-->
<!--            <div>-->
<!--              <label for="child_first_name" class="block text-sm font-medium text-gray-700">Имя</label>-->
<!--              <input type="text" name="first_name" id="child_first_name" value="{{ child_form.first_name.value|default:'' }}" class="w-full border border-gray-300 rounded-lg p-3 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-600">-->
<!--            </div>-->
<!--            <div>-->
<!--              <label for="child_last_name" class="block text-sm font-medium text-gray-700">Фамилия</label>-->
<!--              <input type="text" name="last_name" id="child_last_name" value="{{ child_form.last_name.value|default:'' }}" class="w-full border border-gray-300 rounded-lg p-3 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-600">-->
<!--            </div>-->
<!--            <div>-->
<!--              <label for="child_birth_date" class="block text-sm font-medium text-gray-700">Дата рождения</label>-->
<!--              <input type="date" name="birth_date" id="child_birth_date" value="{{ child_form.birth_date.value|default:'' }}" class="w-full border border-gray-300 rounded-lg p-3 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-600">-->
<!--            </div>-->
<!--          </div>-->
<!--          <button-->
<!--            type="submit"-->
<!--            name="add_child"-->
<!--            class="block w-full md:w-auto bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 focus:outline-none"-->
<!--          >-->
<!--            Добавить ребенка-->
<!--          </button>-->
<!--        </form>-->
<!--      </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Форма редактирования &ndash;&gt;-->
<!--    {% if can_edit %}-->
<!--      <hr class="my-8 border-gray-300">-->
<!--      <div>-->
<!--        <h3 class="text-lg font-bold text-blue-800 mb-4">Редактировать профиль</h3>-->
<!--        <form method="POST" enctype="multipart/form-data" class="space-y-6">-->
<!--          {% csrf_token %}-->
<!--          <div class="grid gap-6 md:grid-cols-2">-->
<!--            {{ edit_form.as_p }}-->
<!--          </div>-->
<!--          <button-->
<!--            type="submit"-->
<!--            class="block w-full md:w-auto bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 focus:outline-none"-->
<!--          >-->
<!--            Сохранить изменения-->
<!--          </button>-->
<!--        </form>-->
<!--      </div>-->
<!--    {% endif %}-->
<!--  </div>-->
<!--</div>-->

<!--&lt;!&ndash; Скрипт для переключения видимости формы &ndash;&gt;-->
<!--<script>-->
<!--  document.addEventListener("DOMContentLoaded", function() {-->
<!--    {% if messages %}-->
<!--      showNotification();-->
<!--    {% endif %}-->
<!--  });-->

<!--  function toggleChildForm() {-->
<!--    var form = document.getElementById("child-form");-->
<!--    var button = document.querySelector("button");-->
<!--    form.classList.toggle("hidden");-->

<!--    var isExpanded = !form.classList.contains("hidden");-->
<!--    button.setAttribute("aria-expanded", isExpanded);-->

<!--    if (isExpanded) {-->
<!--      button.innerHTML = "Отмена";-->
<!--      document.getElementById("child_first_name").focus();  // Фокус на первое поле формы-->
<!--    } else {-->
<!--      button.innerHTML = "Добавить ребенка";-->
<!--    }-->
<!--  }-->

<!--  function showNotification() {-->
<!--    var notification = document.getElementById("notification");-->
<!--    if (notification) {-->
<!--      notification.classList.remove("hidden");-->
<!--      setTimeout(function() {-->
<!--        notification.classList.add("hidden");-->
<!--      }, 7000);-->
<!--    }-->
<!--  }-->
<!--</script>-->
<head>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<div class="min-h-screen bg-gradient-to-b from-orange-100 to-orange-200 py-10 px-4">
  <div class="bg-white shadow-xl rounded-xl p-8 max-w-5xl mx-auto">
    <!-- Заголовок профиля -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-extrabold text-orange-800">Профиль родителя</h1>
      {% if can_edit %}
        <p class="text-gray-600">Просмотр и редактирование личной информации</p>
      {% endif %}
    </div>

    <!-- Блок профиля -->
    <div class="flex flex-col md:flex-row items-center md:items-start gap-8">
      <!-- Фото профиля -->
      <div class="flex-shrink-0 relative">
        <img
          src="{{ user_data.image }}"
          alt="Profile Picture"
          class="w-44 h-44 rounded-full object-cover border-4 border-orange-600 shadow-lg hover:scale-105 transform transition-all duration-300"
          loading="lazy"
        />
      </div>

      <!-- Информация о профиле -->
      <div class="flex-1">
        <div class="space-y-6">
          <div>
            <p class="text-sm text-gray-500">Имя</p>
            <h2 class="text-2xl font-semibold text-orange-900">{{ user_data.first_name }} {{ user_data.last_name }}</h2>
          </div>
          <div>
            <p class="text-sm text-gray-500">Электронная почта</p>
            <p class="text-lg text-gray-700">{{ user_data.email }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Мобильный номер</p>
            <p class="text-lg text-gray-700">{{ user_data.mobile }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Адрес</p>
            <p class="text-lg text-gray-700">{{ user_data.address|default:'' }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Уведомление о добавлении ребенка -->
    {% if messages %}
      <div class="mt-4" id="notification" class="hidden">
        {% for message in messages %}
          <div class="bg-green-500 text-white p-4 rounded-lg">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Список детей -->
    <div>
      <h3 class="text-2xl font-bold text-orange-800 mb-4">Дети</h3>
      <div class="grid gap-6 md:grid-cols-2">
        {% for child in children %}
          <div class="bg-gray-100 p-6 rounded-lg shadow-md hover:shadow-lg transition">
            <h4 class="text-lg font-semibold text-gray-800">{{ child.first_name }} {{ child.last_name }}</h4>
            <p class="text-gray-600">Дата рождения: {{ child.birth_date }}</p>
          </div>
        {% empty %}
          <p class="text-gray-500">Нет данных о детях.</p>
        {% endfor %}
      </div>

      <!-- Кнопка для открытия формы добавления ребенка -->
      {% if can_edit %}
        <button
          type="button"
          onclick="toggleChildForm()"
          class="mt-4 bg-orange-500 text-white py-2 px-6 rounded-lg hover:bg-orange-600 focus:outline-none transition"
          aria-expanded="false"
          aria-controls="child-form"
        >
          {% if form_submitted %}
            Дети добавлены
          {% else %}
            Добавить ребенка
          {% endif %}
        </button>
      {% endif %}

      <!-- Форма добавления ребенка (скрыта по умолчанию) -->
      <div id="child-form" class="mt-6 hidden">
        <form method="POST" class="space-y-6" onsubmit="return validateChildForm(event)">
          {% csrf_token %}
          <div class="grid gap-6 md:grid-cols-2">
            <div>
              <label for="child_first_name" class="block text-sm font-medium text-gray-700">Имя</label>
              <input type="text" name="first_name" id="child_first_name" value="{{ child_form.first_name.value|default:'' }}" class="w-full border border-gray-300 rounded-lg p-3 mt-1 focus:outline-none focus:ring-2 focus:ring-orange-600">
            </div>
            <div>
              <label for="child_last_name" class="block text-sm font-medium text-gray-700">Фамилия</label>
              <input type="text" name="last_name" id="child_last_name" value="{{ child_form.last_name.value|default:'' }}" class="w-full border border-gray-300 rounded-lg p-3 mt-1 focus:outline-none focus:ring-2 focus:ring-orange-600">
            </div>
            <div>
              <label for="child_birth_date" class="block text-sm font-medium text-gray-700">Дата рождения</label>
              <input type="date" name="birth_date" id="child_birth_date" value="{{ child_form.birth_date.value|default:'' }}" class="w-full border border-gray-300 rounded-lg p-3 mt-1 focus:outline-none focus:ring-2 focus:ring-orange-600">
            </div>
          </div>
          <button
            type="submit"
            name="add_child"
            class="block w-full md:w-auto bg-orange-500 text-white py-2 px-6 rounded-lg hover:bg-orange-600 focus:outline-none"
          >
            Добавить ребенка
          </button>
          <div id="form-error" class="text-red-600 hidden">Все поля должны быть заполнены.</div>
        </form>
      </div>
    </div>

    <!-- Форма редактирования -->
    {% if can_edit %}
      <hr class="my-8 border-gray-300">
      <div>
        <h3 class="text-lg font-bold text-orange-800 mb-4">Редактировать профиль</h3>
        <form method="POST" enctype="multipart/form-data" class="space-y-6">
          {% csrf_token %}
          <div class="grid gap-6 md:grid-cols-2">
            {{ edit_form.as_p }}
          </div>
          <button
            type="submit"
            class="block w-full md:w-auto bg-orange-500 text-white py-2 px-6 rounded-lg hover:bg-orange-600 focus:outline-none"
          >
            Сохранить изменения
          </button>
        </form>
      </div>
    {% endif %}
  </div>
</div>

<!-- Скрипт для переключения видимости формы -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    {% if messages %}
      showNotification();
    {% endif %}
  });

  function toggleChildForm() {
    var form = document.getElementById("child-form");
    var button = document.querySelector("button[aria-controls='child-form']");
    form.classList.toggle("hidden");

    var isExpanded = !form.classList.contains("hidden");
    button.setAttribute("aria-expanded", isExpanded);

    if (isExpanded) {
      button.innerHTML = "Отмена";
      document.getElementById("child_first_name").focus();
    } else {
      button.innerHTML = "Добавить ребенка";
    }
  }

  function validateChildForm(event) {
    var firstName = document.getElementById("child_first_name").value.trim();
    var lastName = document.getElementById("child_last_name").value.trim();
    var birthDate = document.getElementById("child_birth_date").value.trim();

    if (!firstName || !lastName || !birthDate) {
      event.preventDefault();
      document.getElementById("form-error").classList.remove("hidden");
      return false;
    }

    return true;
  }

  function showNotification() {
    var notification = document.getElementById("notification");
    if (notification) {
      notification.classList.remove("hidden");
      setTimeout(function() {
        notification.classList.add("hidden");
      }, 7000);
    }
  }
</script>
